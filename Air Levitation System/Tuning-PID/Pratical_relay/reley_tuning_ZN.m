


u = [0, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47]
ref = 500*ones(size(u))
y = [26, 31, 31, 26, 26, 35, 35, 42, 35, 31, 38, 81, 104, 168, 186, 196, 212, 233, 273, 300, 317, 332, 361, 387, 403, 434, 469, 509, 530, 556, 588, 610, 633, 651, 669, 690, 711, 729, 741, 754, 759, 775, 788, 791, 793, 786, 792, 797, 789, 793, 794, 783, 777, 776, 786, 788, 775, 779, 771, 776, 769, 769, 763, 761, 761, 752, 751, 745, 742, 737, 732, 734, 729, 718, 722, 714, 691, 690, 686, 679, 676, 670, 672, 665, 659, 654, 652, 643, 639, 630, 624, 616, 610, 606, 598, 596, 589, 586, 582, 577, 564, 556, 545, 540, 535, 527, 524, 522, 516, 509, 501, 496, 494, 489, 486, 478, 476, 466, 462, 454, 448, 442, 436, 430, 421, 418, 412, 408, 403, 398, 392, 391, 387, 384, 382, 385, 388, 391, 402, 410, 423, 438, 451, 467, 486, 506, 525, 550, 577, 598, 620, 639, 727, 743, 755, 766, 769, 779, 777, 779, 784, 781, 782, 782, 784, 779, 782, 780, 768, 768, 759, 748, 749, 735, 730, 722, 717, 706, 690, 691, 682, 673, 667, 658, 657, 650, 640, 624, 618, 603, 596, 592, 579, 579, 568, 573, 563, 561, 556, 553, 549, 526, 520, 517, 515, 512, 511, 506, 505, 498, 496, 496, 491, 488, 486, 480, 475, 469, 474, 469, 467, 466, 463, 457, 451, 447, 446, 448, 441, 440, 434, 433, 429, 429, 423, 418, 412, 411, 403, 397, 389, 387, 386, 387, 390, 393, 400, 410, 426, 434, 451, 467, 491, 516, 533, 560, 584, 606, 629, 645, 665, 680, 699, 714, 738, 745, 751, 753, 765, 764, 773, 777, 780, 774, 777, 771, 771, 758, 754, 749, 737, 736, 729, 724, 720, 714, 711, 711, 706, 701, 692, 684, 679, 674, 670, 669, 661, 659, 652, 651, 647, 636, 627, 617, 610, 601, 593, 580, 582, 574, 571, 569, 560, 552, 544, 536, 529, 525, 520, 518, 514, 501, 495, 489, 482, 473, 465, 457, 454, 452, 448, 441, 438, 435, 422, 421, 413, 410, 405, 400, 393, 388, 391, 387, 385, 390, 397, 404, 415, 420, 436, 441, 460, 482, 498, 522, 545, 569, 597, 617, 639, 668, 696, 716, 744, 773, 781, 794, 798, 807, 811, 806, 809, 810, 806, 793, 776, 769, 758, 734, 726, 716, 712, 708, 706, 699, 691, 688, 685, 677, 676, 670, 666, 659, 658, 650, 648, 640, 627, 621, 616, 610, 606, 600, 596, 590, 582, 583, 577, 578, 564, 563, 556, 544, 536, 517, 518, 516, 506, 502, 500, 498, 493, 489, 486, 483, 479, 475, 471, 465, 457, 455, 453, 445, 436, 432, 432, 427, 416, 413, 405, 397, 392, 385, 381, 380, 376, 378, 382, 385, 390, 398, 405, 418, 430, 440, 455, 467, 488, 507, 530, 552, 580, 601, 620, 642, 677, 697, 712, 721, 735, 747, 748, 753, 751, 761, 765, 762, 764, 760, 761, 761, 753, 751, 750, 749, 749, 744, 740, 733, 724, 720, 720, 715, 706, 697, 696, 690, 690, 684]


%%
nptos = size(u,2)
Tamostra = 0.06




%%
% --- Calcula período
kont = 0;								
for t = 4:nptos,								
   if u(t) ~= u(t-1)
      kont = kont + 1;
      ch(kont) = t;
   end
end
%%
Tu1 = (ch(7) - ch(6))*Tamostra;
Tu2 = (ch(8) - ch(7))*Tamostra;
Tu = Tu1 + Tu2 %Periodo critico;
omega = (2*pi)/(Tu)
aux1 = ch(5);aux2 = ch(7);
% --- Calcula valor de pico positivo
arm = eps;										
for t = aux1:aux2,
   if y(t) >= arm  arm = y(t); end;
end;
Au = arm;
% --- Calcula valor de pico negativo
arm = eps;										
for t = aux1:aux2,
   if y(t) <= arm  arm = y(t); end;
end;
Ad = arm;
a = (abs(Au) + abs(Ad))/2
% --- Calcula ganho critico
Ku = (4*d)/(pi*sqrt(a^2 - eps^2));
% --- Constantes da planta

%% --- Gráfico da saída e entrada
figure(1)
rele = [u;y];
plot(tempo,rele);
%% --- Sintonia por Ziegler-Nichols
Kc = 0.6*Ku
Ti = 0.5*Tu
Td = Ti/4